{%extends 'base.html'%}
{%block title%}IB Options{%endblock%}
{%block content%}
<h1>Select your options</h1>
<form method = "POST" id = "form">
  <!-- This is where the inputs go -->
</form>
<button onclick = "left()" id = "left" class = "btn btn-primary" style = "background-color:black;border:none">&larr;</button>
<button onclick = "right()" id = "right" class = "btn btn-primary" style = "background-color:black;border:none">&rarr;</button>
<script>
  function changeOpacity(current,change,idx){ // This function is called to change the opacity of a slide
    if(current>=1 && change >0){ // Checks if the opacity is greater than or equal to 1 and the change is positive
      return null // This is the base case for the recursion
    }
    if(current<=0 && change <0){ // Checks if the opacity is less than or equal to 0 and the change is negative
      return null // This is the base case for the recursion
    }
    current+=change // This changes the opacity of the slide
    slides[idx].style.opacity = current.toString() // This changes the opacity of the slide
    setTimeout(function(){changeOpacity(current,change,idx)},10) // This calls the function again after 10 milliseconds
  }
  function transition(slide1,slide2){ // This function is called to transition between slides
    changeOpacity(1,-0.1,slide1) // This changes the opacity of the slide
      setTimeout(function (){ // This function is called after 250 milliseconds
        slides[slide2].style.opacity = "0" // This sets the opacity of the slide to 0
        slides[slide2].style.display = "block" // Shows new slide
        slides[slide1].style.display = "none" // Hides old slide
        changeOpacity(0,0.1,slide2)},250) // This changes the opacity of the slide
  }
  function unloadPage(){ // This function is called when the user tries to leave the page
      if(unsaved){ // Checks if the user has unsaved changes
          return "You have unsaved changes on this page. Do you want to leave this page and discard your changes or stay on this page?" // This is the message that will be displayed to the user
      }
  }
  window.onbeforeunload = unloadPage // This is used to check if the user has unsaved changes when they try to leave the page
  unsaved = false // This is used to check if the user has unsaved changes
  slide = 0 // This is used to keep track of the current slide
  function left(t=true,s=false){ // This function is called when the user clicks the left arrow
    slide-- // Decreases the slide number by 1
    document.getElementById("right").hidden = false // Shows the right arrow
    if(slide<=0){ // Checks if the user is on the first slide  
      slide = 0 // If the user is on the first slide, we set the slide number to 0
      document.getElementById("left").hidden = true // Hides the left arrow
    }
    else{ // The user is not on the first slide
      document.getElementById("left").hidden = false // Shows the left arrow
    }
    if(s){ // Checks if the slides have been initialized
      slides = [intro,plans,Ainput,language_input,humanities_input,science_input,math_input,group6_input,art_input] // This is a list of all the slides
    }
    if(t){ // If a transition is required, we use t as transition is used for the function
      transition(slide+1,slide) // This function is called to transition between slides
    }
    else{ // Manually shows and hides slides
      slides[slide].style.display = "block" // Shows the current slide
      slides[slide+1].style.display = "none" // Hides previous slide
    }
  }
  function right(t=true,s=false){ // This function is called when the user clicks the right arrow
    slide++ // Increases the slide number by 1
    document.getElementById("left").hidden = false // Shows the left arrow
    if(slide>=8){ // Checks if the user is on the last slide
      slide = 8 // If the user is on the last slide, we set the slide number to 8
      document.getElementById("right").hidden = true // Hides the right arrow
    }
    else{ // The user is not on the last slide
        document.getElementById("right").hidden = false // Shows the right arrow
    }
    if(s){ // Checks if the slides have been initialized
      slides = [intro,plans,Ainput,language_input,humanities_input,science_input,math_input,group6_input,art_input] // This is a list of all the slides
    }
    if(t){ // If a transition is required, we use t as transition is used for the function
      transition(slide-1,slide) // This function is called to transition between slides
    }
    else{ // Manually shows and hides slides
      slides[slide-1].style.display = "none" // Hides the previous slide
      slides[slide].style.display = "block" // Shows the current slide
    }
  }
  window.onload = function(){ // This function is called when the page loads
    left(false,true) // Calls the left function to hide the right arrow
    for(var i=1;i<slides.length;i++){ // Loop through all the slides except the first one to hide them
      slides[i].style.display = "none" // Hides this slide
    }
    document.getElementById("Group 6: Arts").checked = true // Checks the group 6 radio button
    document.getElementById("Group 6: Arts").onchange() // Calls the onchange function for the group 6 radio button
  }
  form = document.getElementById("form") // This gets the form element
  As = ["English A","Chinese A","School Supported Self Taught Literature"] // This is the list of A languages
  languages = ["English B","French B","Spanish B","Chinese B","Spanish Ab Initio","French Ab Initio","Chinese Ab Initio"] // This is the list of foreign languages 
  math = ["Analysis and Approaches","Applications and Interpretations"] // This is the list of math levels
  humanities = ["Business Management","Economics","Geography","Psychology","History"] // This is the list of humanities subjects
  sciences = ["Biology","Chemistry","Computer Science","Environmental Systems and Sciences","Physics","Sports Science"] // This is the list of science subjects
  arts = ["Music","Theatre Arts","Visual Arts"] // This is the list of arts subjects
  intro = document.createElement("div") // This is the div that will contain the introduction
  intro.id = "intro" // This allows us to keep track of the div in frontend
  h3 = document.createElement("h3") // This is the h3 element that will contain the title of the slide
  h3.innerText = "IB Options for AY 26/27" // This sets the inner text of the h3 element
  intro.appendChild(h3) // This adds the h3 element to the div
  p = document.createElement("p") // This is the p element that will contain the subtitle of the slide
  p.innerHTML = "Please use <a href = 'ibdp.options.nexus.edu.sg'>this link</a> to learn more about the IBDP options at Nexus.<br />Please complete each section of this form to let us know the options you would like to take for either IB Course or the full IBDP.<br />Please remember you must have 3 higher levels and 3 standard levels for the full diploma.<br />If you wish to do IB Courses please select IB Courses in each of the blocks you do not wish to take.<br />Your option data is needed to help us plan our staffing and timetable. Even if you are unsure if you will be staying at Nexus please submit your options.<br />"/*<b>Please click <a href = '/plans/ib'>here</a> to select your future plans for the IB</b><br />*/+"You will be contacted if there are any problems timetabling your selected subjects. <br />Please submit your options by 3pm Friday 5th December. You will have a one to one meeting with Ms Vicky in January to discuss these options." // This sets the inner text of the p element
  intro.appendChild(p) // This adds the p element to the div
  p = document.createElement("p") // Creates new p
  checkbox = document.createElement("input") // Creates new input
  checkbox.type = "checkbox" // Makes it a checkbox
  checkbox.name = "email" // Allows us to search for the inputs by name in the backend
  checkbox.id = "email" // Allows us to track the checkbox in the frontend
  checkbox.style.margin = "0px 5px 0px 0px"
  p.appendChild(checkbox) // Adds the checkbox to the form
  label = document.createElement("label") // Creates label for the input
  label.innerHTML = " I wish to receive a copy of these choices to my email address" // This is the text that will be displayed to the user
  p.appendChild(label) // Adds the label to the form
  intro.appendChild(p) // Adds the p to the form so users know what to select
  form.appendChild(intro) // This adds the div to the form
  plans = document.createElement("div") // This is the div that will contain the plans
  plans.id = "plans" // This allows us to keep track of the div in frontend
  plans.innerHTML = `
    <h3>Will you be studying IB at nexus?</h3>
    {%for option in ib_plans%}
      <input type = "radio" name = "ib" value = "{{option}}" {%if user.studying_ib == option%} checked {%endif%}/>
      {{option}}
      <br />
    {%endfor%}`
  form.appendChild(plans) // This adds the div to the form
  Ainput = document.createElement("div") // This is the div that will contain the A language inputs
  Ainput.className = "form-group" // This sets the class of the div
  h3 = document.createElement("h3") // This is the h3 element that will contain the title of the slide
  h3.innerText = "Select your 'A' language" // This sets the inner text of the h3 element
  h5 = document.createElement("h5") // This is the h5 element that will contain the subtitle of the slide
  h5.innerHTML = "Please note you should have studied First Language to take an 'A' language. An 'A' Language is your strongest language. <br /><br />For School Supported Self Taught you will need to pay for a school approved tutor and should have a strong background in this language. This is a literature based course." // This sets the inner text of the h5 element
  Ainput.appendChild(h3) // This adds the h3 element to the div
  Ainput.appendChild(h5) // This adds the h5 element to the div
  for(var A of As){ // This loops through all the A languages
    radio = document.createElement("input") // This creates a new input element
    radio.type = "radio" // This sets the type of the input element
    radio.name = "group1" // This sets the name of the radio button
    radio.value = A // This sets the value of the radio button
    radio.id = A // This sets the id of the radio button
    radio.required = true // This makes the radio button required
    label = document.createElement("label") // This creates a new label element
    label.for = A // This sets the for attribute of the label
    label.innerText = A // This sets the inner text of the label
    Ainput.appendChild(radio) // This adds the radio button to the div
    Ainput.appendChild(label) // This adds the label to the div
    radio.onchange = function(){ // This is the onchange function for the radio button
      for(i of As){ // This loops through all the A languages
        document.getElementById(i+"-select").hidden = true // This hides the select element for the A language
      }
      if(this.value == "Chinese A"){ // Checks if the user has selected Chinese A
        document.getElementById("ssst-input").hidden = true // This hides the input element for the School Supported Self Taught Literature language
        bools = [document.getElementById("Chinese B").checked,document.getElementById("Chinese Ab Initio").checked,!(!document.querySelector("input[id='Chinese B'][name='group6']") || !document.querySelector("input[id='Chinese B'][name='group6']").checked),!(!document.querySelector("input[id='Chinese Ab Initio'][name='group6']") || !document.querySelector("input[id='Chinese Ab Initio'][name='group6']").checked)] // This is a list of booleans that represent whether the user has selected Chinese B or Chinese Ab Initio
        if(bools.includes(true)){ // Checks if the user has selected Chinese B or Chinese Ab Initio
          idx = bools.indexOf(true) // This gets the index of the first true value in the list
          if(idx == 0 || idx == 2){ // Checks if the user has selected Chinese B or Chinese B from group 6
            flash("Chinese B has been deselected from your options","info") // This is the info message that is displayed if the user has selected Chinese B or Chinese B from group 6
          }
          if(idx == 1 || idx == 3){ // Checks if the user has selected Chinese Ab Initio or Chinese Ab Initio from group 6
            flash("Chinese Ab Initio has been deselected from your options","info") // This is the info message that is displayed if the user has selected Chinese Ab Initio or Chinese Ab Initio from group 6
          }
        }
        document.getElementById("Chinese B").checked = false // This unchecks the Chinese B radio button
        document.getElementById("Chinese Ab Initio").checked = false // This unchecks the Chinese Ab Initio radio button
        document.getElementById("Chinese B-select").hidden = true // This hides the select element for Chinese B
        document.getElementById("Chinese Ab Initio-select").hidden = true // This hides the select element for Chinese Ab Initio
        element1 = document.querySelector("input[id='Chinese B'][name='group6']") // This gets the Chinese B radio button from group 6
        if(element1){ // Checks if the Chinese B radio button from group 6 exists
          element1.checked = false // This unchecks the Chinese B radio button from group 6
          document.getElementById("Chinese B-select-group6").hidden = true // This hides the select element for Chinese B from group 6
        }
        element2 = document.querySelector("input[id='Chinese Ab Initio'][name='group6']") // This gets the Chinese Ab Initio radio button from group 6
        if(element2){ // Checks if the Chinese Ab Initio radio button from group 6 exists
          element2.checked = false // This unchecks the Chinese Ab Initio radio button from group 6
          document.getElementById("Chinese Ab Initio-select-group6").hidden = true // This hides the select element for Chinese Ab Initio from group 6
        }
      }
      else if(this.value == "English A"){ // Checks if the user has selected English A
        document.getElementById("ssst-input").hidden = true // This hides the input element for the School Supported Self Taught Literature language
        bools = [document.getElementById("English B").checked,!(!document.querySelector("input[id='English B'][name='group6']") || !document.querySelector("input[id='English B'][name='group6']").checked)] // This is a list of booleans that represent whether the user has selected English B or English B from group 6
        if(bools.includes(true)){ // Checks if the user has selected English B or English B from group 6
          idx = bools.indexOf(true) // This gets the index of the first true value in the list
          if(idx == 0 || idx == 1){ // Checks if the user has selected English B or English B from group 6
            flash("English B has been deselected from your options","info") // This is the info message that is displayed if the user has selected English B or English B from group 6
          }
        }
        document.getElementById("English B").checked = false // This unchecks the English B radio button
        document.getElementById("English B-select").hidden = true // This hides the select element for English B
        element1 = document.querySelector("input[id='English B'][name='group6']") // This gets the English B radio button from group 6
        if(element1){ // Checks if the English B radio button from group 6 exists
          element1.checked = false // This unchecks the English B radio button from group 6
          document.getElementById("English B-select-group6").hidden = true // This hides the select element for English B from group 6
        }
        ssst_br.hidden = true // This hides the newline after the input element for the School Supported Self Taught Literature language
      }
      else{
        document.getElementById("ssst-input").hidden = false // This shows the input element for the School Supported Self Taught Literature language
        ssst_br.hidden = false // This shows the newline after the input element for the School Supported Self Taught Literature language
      }
      document.getElementById(this.value+"-select").hidden = false // This shows the select element for the selected A language
    }
    select = document.createElement("select") // This creates a new select element
    select.id = A+"-select" // This sets the id of the select element
    select.className = "form-control" // This sets the class of the select element
    select.name = A+"-select" // This sets the name of the select element
    select.hidden = true // This hides the select element for the A language
    option = document.createElement("option") // This creates a new option element
    option.value = "SL" // This sets the value of the option element
    option.innerText = "SL" // This sets the inner text of the option element
    select.appendChild(option) // This adds the option to the select element
    if(A!=As[2]){ // Checks if the A language is not School Supported
      option = document.createElement("option") // This creates a new option element
      option.value = "HL" // This sets the value of the option element
      option.innerText = "HL" // This sets the inner text of the option element
      select.appendChild(option) // This adds the option to the select element
    }
    Ainput.appendChild(select) // This adds the select element to the div
    newline = document.createElement("br") // This creates a new line element
    Ainput.appendChild(newline) // This adds a newline to the form
  }
  ssst_input = document.createElement("input") // This creates a new input element
  ssst_input.className = "form form-control" // This sets the bootstrap class to make it look better
  ssst_input.placeholder = "Enter the language you wish to study as your 'A' language" // This sets the placeholder text of the input element
  ssst_input.id = "ssst-input" // This sets the id of the input element
  ssst_input.name = "ssst-input"
  ssst_input.hidden = true // This hides the input element
  Ainput.appendChild(ssst_input) // This adds the input element to the form
  ssst_br= document.createElement("br") // This creates a new line element
  Ainput.appendChild(ssst_br) // This adds a newline to the form
  ssst_br.hidden = true // This hides the newline
  courses = document.createElement("input") // This creates a new input element
  courses.type = "radio" // This sets the type of the input element
  courses.name = "group1" // This sets the name of the radio button
  courses.id = "courses-group1" // This sets the id of the radio button
  courses.value = "IB Courses" // This sets the value of the radio button
  courses.required = true // This makes the radio button required
  courses.onchange = function(){ // This is the onchange function for the radio button
    for(i of As){ // This loops through all the A languages
      document.getElementById(i+"-select").hidden = true // This hides the select element for the A language
    }
    document.getElementById("ssst-input").hidden = true // This hides the input element for the School Supported Self Taught Literature language
    ssst_br.hidden = true // This hides the newline after the input element for the School Supported Self Taught Literature language
  }
  label = document.createElement("label") // This creates a new label element
  label.for = "courses-group1" // This sets the for attribute of the label
  label.innerText = "IB Courses" // This sets the inner text of the label
  Ainput.appendChild(courses) // This adds the radio button to the form
  Ainput.appendChild(label) // This adds the label to the form
  newline = document.createElement("br") // This creates a new line element
  Ainput.appendChild(newline) // This adds a newline to the form
  form.appendChild(Ainput) // This adds the A language input to the form
  h3 = document.createElement("h3") // This creates a new h3 element
  h3.innerText = "Select your second language:" // This sets the inner text of the h3 element
  h5 = document.createElement("h5") // This creates a new h5 element
  h5.innerHTML = "You should have studied a 'B' language for at least 3-4 years prior to taking it at IBDP- you should be able to read/write well in this language.<br />Ab initio courses are for those with limited experience and no formal qualification in the language." // This sets the inner text of the h5 element
  language_input = document.createElement("div") // This creates a new div element
  language_input.appendChild(h3) // This adds the h3 element to the div element
  language_input.appendChild(h5) // This adds the h5 element to the div element
  language_input.className = "form-group" // This sets the class of the div element
  for(var language of languages){ // This loops through all the foreign languages
    radio = document.createElement("input") // This creates a new input element
    radio.type = "radio" // This sets the type of the input element
    radio.name = "group2" // This sets the name of the radio button
    radio.value = language // This sets the value of the radio button
    radio.id = language // This sets the id of the radio button
    radio.required = true // This makes the radio button required
    label = document.createElement("label") // This creates a new label element
    label.for = language // This sets the for attribute of the label
    label.innerText = language // This sets the inner text of the label
    select = document.createElement("select") // This creates a new select element
    select.id = language+"-select" // This sets the id of the select element
    select.className = "form-control" // This sets the class of the select element
    select.name = language+"-select" // This sets the name of the select element
    select.hidden = true // This hides the select element for the foreign language
    option = document.createElement("option") // This creates a new option element
    option.value = "SL" // This sets the value of the option element
    option.innerText = "SL" // This sets the inner text of the option element
    select.appendChild(option) // This adds the option to the select element
    if(!language.toLowerCase().includes("ab initio")){ // Checks if the foreign language is not Ab Initio
      option = document.createElement("option") // This creates a new option element
      option.value = "HL" // This sets the value of the option element
      option.innerText = "HL" // This sets the inner text of the option element
      select.appendChild(option) // This adds the option to the select element
    }
    radio.onchange = function(){ // This is the onchange function for the radio button
      for(i of languages){ // This loops through all the foreign languages
        document.getElementById(i+"-select").hidden = true // This hides the select element for the foreign language
      }
      try{ // This is the try block that is used to check if the user has selected Chinese A or English A from group 6
        chinese_group6 = document.getElementById("Chinese A-group6").checked // This is the boolean that represents whether the user has selected Chinese A from group 6
        english_group6 = document.getElementById("English A-group6").checked // This is the boolean that represents whether the user has selected English A from group 6
      }
      catch{ // This is the exception that is thrown if the user has not selected Chinese A or English A from group 6
        chinese_group6 = false // This is the boolean that represents whether the user has selected Chinese A from group 6
        english_group6 = false // This is the boolean that represents whether the user has selected English A from group 6
      }
      document.getElementById(this.value+"-select").hidden = false // This shows the select element for the selected foreign language
      if(this.value.includes("Chinese") && document.getElementById("Chinese A").checked){ // Checks if the user has selected Chinese A
        document.getElementById("Chinese A").checked = false // This unchecks the Chinese A radio button
        document.getElementById("Chinese A-select").hidden = true // This hides the select element for Chinese A
        flash("Chinese A has been deselected from your options","info") // This is the info message that is displayed if the user has selected Chinese A
      }
      else if(this.value.includes("Chinese") && chinese_group6){ // Checks if the user has selected Chinese A from group 6
        document.getElementById("Chinese A-group6").checked = false // This unchecks the Chinese A radio button from group 6
        document.getElementById("Chinese A-select-group6").hidden = true // This hides the select element for Chinese A from group 6
        flash("Chinese A has been deselected from your options","info") // This is the info message that is displayed if the user has selected Chinese A or Chinese A from group 6
      }
      else if(this.value.includes("English") && document.getElementById("English A").checked){ // Checks if the user has selected English A
        document.getElementById("English A").checked = false // This unchecks the English A radio button
        document.getElementById("English A-select").hidden = true // This hides the select element for English A
        flash("English A has been deselected from your options","info") // This is the info message that is displayed if the user has selected English A
      }
      else if(this.value.includes("English") && english_group6){ // Checks if the user has selected English A from group 6
        document.getElementById("English A-group6").checked = false // This unchecks the English A radio button from group 6
        document.getElementById("English A-select-group6").hidden = true // This hides the select element for English A from group 6
        flash("English A has been deselected from your options","info") // This is the info message that is displayed if the user has selected English A or English A from group 6
      }
    }
    language_input.appendChild(radio) // This adds the radio button to the form
    language_input.appendChild(label) // This adds the label to the form
    language_input.appendChild(select) // This adds the select element to the form
    newline = document.createElement("br") // This creates a new line element
    language_input.appendChild(newline) // Adds a newline to the form
  }
  courses = document.createElement("input") // This creates a new input element
  courses.type = "radio" // This sets the type of the input element
  courses.name = "group2" // This sets the name of the radio button
  courses.id = "courses-group2" // This sets the id of the radio button
  courses.value = "IB Courses" // This sets the value of the radio button
  courses.required = true // This makes the radio button required
  courses.onchange = function(){ // This is the onchange function for the radio button
    for(i of languages){ // This loops through all the languages
      document.getElementById(i+"-select").hidden = true // This hides the select element for the A language
    }
  }
  label = document.createElement("label") // This creates a new label element
  label.for = "courses-group2" // This sets the for attribute of the label
  label.innerText = "IB Courses" // This sets the inner text of the label
  language_input.appendChild(courses) // This adds the radio button to the form
  language_input.appendChild(label) // This adds the label to the form
  newline = document.createElement("br") // This creates a new line element
  language_input.appendChild(newline) // This adds a newline to the form
  form.appendChild(language_input) // This adds the language input to the form
  h3 = document.createElement("h3") // This creates a new h3 element
  h3.innerText = "Select your subject from the humanities:" // This sets the inner text of the h3 element
  h5 = document.createElement("h5") // This creates a new h5 element
  h5.innerHTML = "You do not need to have studied these subjects before but you will have an advantage if you have some background in the subject at IGCSE or other curriculum. For HL in all these subjects you will need to have a high level of written English. For HL Economics you should ideally have an IGCSE grade of a 6 or above." // This sets the inner text of the h5 element
  humanities_input = document.createElement("div") // This creates a new div element
  humanities_input.appendChild(h3) // This adds the h3 element to the div element
  humanities_input.appendChild(h5) // This adds the h5 element to the div element
  humanities_input.className = "form-group" // This sets the class of the div element
  for(var humanity of humanities){ // This loops through all the humanities subjects
    radio = document.createElement("input") // This creates a new input element
    radio.type = "radio" // This sets the type of the input element
    radio.name = "group3" // This sets the name of the radio button
    radio.value = humanity // This sets the value of the radio button
    radio.id = humanity // This sets the id of the radio button
    radio.required = true // This makes the radio button required
    label = document.createElement("label") // This creates a new label element
    label.for = humanity // This sets the for attribute of the label
    label.innerText = humanity // This sets the inner text of the label
    select = document.createElement("select") // This creates a new select element
    select.id = humanity+"-select" // This sets the id of the select element
    select.className = "form-control" // This sets the class of the select element
    select.name = humanity+"-select" // This sets the name of the select element
    select.hidden = true // This hides the select element for the humanities subject
    option = document.createElement("option") // This creates a new option element
    option.value = "SL" // This sets the value of the option element
    option.innerText = "SL" // This sets the inner text of the option element
    select.appendChild(option) // This adds the option to the select element
    option = document.createElement("option") // This creates a new option element
    option.value = "HL" // This sets the value of the option element
    option.innerText = "HL" // This sets the inner text of the option element
    select.appendChild(option) // This adds the option to the select element
    radio.onchange = function(){ // This is the onchange function for the radio button
      for(i of humanities){ // This loops through all the humanities subjects
        document.getElementById(i+"-select").hidden = true // This hides the select element for the humanities subject
      }
      document.getElementById(this.value+"-select").hidden = false // This shows the select element for the selected humanities subject
    }
    humanities_input.appendChild(radio) // This adds the radio button to the form
    humanities_input.appendChild(label) // This adds the label to the form
    humanities_input.appendChild(select) // This adds the select element to the form
    newline = document.createElement("br") // This creates a new line element
    humanities_input.appendChild(newline) // Adds a newline to the form
  }
  courses = document.createElement("input") // This creates a new input element
  courses.type = "radio" // This sets the type of the input element
  courses.name = "group3" // This sets the name of the radio button
  courses.id = "courses-group3" // This sets the id of the radio button
  courses.value = "IB Courses" // This sets the value of the radio button
  courses.required = true // This makes the radio button required
  courses.onchange = function(){ // This is the onchange function for the radio button
    for(i of humanities){ // This loops through all the humanities
      document.getElementById(i+"-select").hidden = true // This hides the select element for the A language
    }
  }
  label = document.createElement("label") // This creates a new label element
  label.for = "courses-group3" // This sets the for attribute of the label
  label.innerText = "IB Courses" // This sets the inner text of the label
  humanities_input.appendChild(courses) // This adds the radio button to the form
  humanities_input.appendChild(label) // This adds the label to the form
  newline = document.createElement("br") // This creates a new line element
  humanities_input.appendChild(newline) // This adds a newline to the form
  form.appendChild(humanities_input) // This adds the humanities input to the form
  h3 = document.createElement("h3") // This creates a new h3 element
  h3.innerText = "Select your subject from the sciences:" // This sets the inner text of the h3 element
  h5 = document.createElement("h5") // This creates a new h5 element
  h5.innerHTML = "For Higher Level (HL) Sciences you should have achieved <b>at least</b> an IGCSE '7' or equivalent for the Science courses you studied. " // This sets the inner text of the h5 element
  science_input = document.createElement("div") // This creates a new div element
  science_input.appendChild(h3) // This adds the h3 element to the div element
  science_input.appendChild(h5) // This adds the h5 element to the div element
  science_input.className = "form-group" // This sets the class of the div element
  for(var science of sciences){ // This loops through all the science subjects
    radio = document.createElement("input") // This creates a new input element
    radio.type = "radio" // This sets the type of the input element
    radio.name = "group4" // This sets the name of the radio button
    radio.value = science // This sets the value of the radio button
    radio.id = science // This sets the id of the radio button
    radio.required = true // This makes the radio button required
    label = document.createElement("label") // This creates a new label element
    label.for = science // This sets the for attribute of the label
    label.innerText = science // This sets the inner text of the label
    select = document.createElement("select") // This creates a new select element
    select.name = science+"-select" // This sets the name of the select element
    select.id = science+"-select" // This sets the id of the select element
    select.className = "form-control" // This sets the class of the select element
    select.hidden = true // This hides the select element for the science subject
    option = document.createElement("option") // This creates a new option element
    option.value = "SL" // This sets the value of the option element
    option.innerText = "SL" // This sets the inner text of the option element
    select.appendChild(option) // This adds the option to the select element
    option = document.createElement("option") // This creates a new option element
    option.value = "HL" // This sets the value of the option element
    option.innerText = "HL" // This sets the inner text of the option element
    select.appendChild(option) // This adds the option to the select element
    radio.onchange = function(){ // This is the onchange function for the radio button
      for(i of sciences){ // This loops through all the science subjects
        document.getElementById(i+"-select").hidden = true // This hides the select element for the science subject
      }
      document.getElementById(this.value+"-select").hidden = false // This shows the select element for the selected science subject
    }
    science_input.appendChild(radio) // This adds the radio button to the form
    science_input.appendChild(label) // This adds the label to the form
    science_input.appendChild(select) // This adds the select element to the form
    newline = document.createElement("br") // This creates a new line element
    science_input.appendChild(newline) // Adds a newline to the form
  }
  courses = document.createElement("input") // This creates a new input element
  courses.type = "radio" // This sets the type of the input element
  courses.name = "group4" // This sets the name of the radio button
  courses.id = "courses-group4" // This sets the id of the radio button
  courses.value = "IB Courses" // This sets the value of the radio button
  courses.required = true // This makes the radio button required
  courses.onchange = function(){ // This is the onchange function for the radio button
    for(i of sciences){ // This loops through all the humanities
      document.getElementById(i+"-select").hidden = true // This hides the select element for the A language
    }
  }
  label = document.createElement("label") // This creates a new label element
  label.for = "courses-group4" // This sets the for attribute of the label
  label.innerText = "IB Courses" // This sets the inner text of the label
  science_input.appendChild(courses) // This adds the radio button to the form
  science_input.appendChild(label) // This adds the label to the form
  newline = document.createElement("br") // This creates a new line element
  science_input.appendChild(newline) // This adds a newline to the form
  form.appendChild(science_input) // This adds the science input to the form
  h3 = document.createElement("h3") // This creates a new h3 element
  h3.innerText = "Select your math level:" // This sets the inner text of the h3 element
  h5 = document.createElement("h5") // This creates a new h5 element
  h5.innerHTML = "Please only consider Higher Level if you have already achieved a high pass at IGCSE (preferably a 9 or A/A*) or equivalent. You should have studied some form of advanced or further mathematics for HL.<br /> <br />If you opt to do Foundation Maths at IGCSE then you need to select Maths AI. Maths AI may not be accepted by all universities for certain courses, please check the requirements of where you think you may apply." // This sets the inner text of the h5 element
  math_input = document.createElement("div") // This creates a new div element
  math_input.appendChild(h3) // This adds the h3 element to the div element
  math_input.appendChild(h5) // This adds the h5 element to the div element
  math_input.className = "form-group" // This sets the class of the div element
  for(var m of math){ // This loops through all the math levels
    radio = document.createElement("input") // This creates a new input element
    radio.type = "radio" // This sets the type of the input element
    radio.name = "group5" // This sets the name of the radio button
    radio.value = m // This sets the value of the radio button
    radio.id = m // This sets the id of the radio button
    radio.required = true // This makes the radio button required
    label = document.createElement("label") // This creates a new label element
    label.for = m // This sets the for attribute of the label
    label.innerText = m // This sets the inner text of the label
    select = document.createElement("select") // This creates a new select element
    select.id = m+"-select" // This sets the id of the select element
    select.className = "form-control" // This sets the class of the select element
    select.hidden = true // This hides the select element for the math level
    select.name = m+"-select" // This sets the name of the select element
    option = document.createElement("option") // This creates a new option element
    option.value = "SL" // This sets the value of the option element
    option.innerText = "SL" // This sets the inner text of the option element
    select.appendChild(option) // This adds the option to the select element
    if(!m.includes("Interpretation")){ // Checks if the math level is not Applications and Interpretations
      option = document.createElement("option") // This creates a new option element
      option.value = "HL" // This sets the value of the option element
      option.innerText = "HL" // This sets the inner text of the option element
      select.appendChild(option) // This adds the option to the select element
    }
    radio.onchange = function(){ // This is the onchange function for the radio button
      for(i of math){ // This loops through all the math levels
        document.getElementById(i+"-select").hidden = true // This hides the select element for the math level
      }
      document.getElementById(this.value+"-select").hidden = false // This shows the select element for the selected math level
    }
    math_input.appendChild(radio) // This adds the radio button to the form
    math_input.appendChild(label) // This adds the label to the form
    math_input.appendChild(select) // This adds the select element to the form
    newline = document.createElement("br") // This creates a new line element
    math_input.appendChild(newline) // Adds a newline to the form
  }
  courses = document.createElement("input") // This creates a new input element
  courses.type = "radio" // This sets the type of the input element
  courses.name = "group5" // This sets the name of the radio button
  courses.id = "courses-group5" // This sets the id of the radio button
  courses.value = "IB Courses" // This sets the value of the radio button
  courses.required = true // This makes the radio button required
  courses.onchange = function(){ // This is the onchange function for the radio button
    for(i of math){ // This loops through all the humanities
      document.getElementById(i+"-select").hidden = true // This hides the select element for the A language
    }
  }
  label = document.createElement("label") // This creates a new label element
  label.for = "courses-group5" // This sets the for attribute of the label
  label.innerText = "IB Courses" // This sets the inner text of the label
  math_input.appendChild(courses) // This adds the radio button to the form
  math_input.appendChild(label) // This adds the label to the form
  newline = document.createElement("br") // This creates a new line element
  math_input.appendChild(newline) // This adds a newline to the form
  form.appendChild(math_input) // This adds the math input to the form
  h3 = document.createElement("h3") // This creates a new h3 element
  h3.innerText = "Select the group from which you will take your sixth subject:" // This sets the inner text of the h3 element
  group6_input = document.createElement("div") // This creates a new div element
  group6_input.appendChild(h3) // This adds the h3 element to the div element
  group6_input.className = "form-group" // This sets the class of the div element
  {%set groups = ["Group 3: Individuals and Societies","Group 4: Sciences","Group 6: Arts"]%} // This is a list of all the groups
  {%set group_subjects = [["Business Management","Economics","Psychology"],["Biology","Physics"],["Music","Theatre Arts","Visual Arts"]]%} // This is a list of all the subjects in each group
  {%set counter = namespace(value=0)%} // This is a counter that is used to keep track of the index of the group
  {%for group in groups%} // This loops through all the groups
    {%set idx = counter.value%} // This sets the index of the group
    radio = document.createElement("input") // This creates a new input element
    radio.type = "radio" // This sets the type of the input element
    radio.name = "group6-subject" // This sets the name of the radio button
    radio.value = "{{group}}" // This sets the value of the radio button
    radio.id = "{{group}}" // This sets the id of the radio button
    radio.required = true // This makes the radio button required
    radio.onchange = function(){ // This is the onchange function for the radio button
      toclone = [humanities_input,science_input,art_input][{{idx}}] // This gets the div element that contains the subjects for the group
      new_input = document.createElement("div") // This creates a new div element
      count = 0 // If we encounter an element that is not in the subject selections for group 6, we skip 4 elements (radio, select, label, br)
      for(i of toclone.children){ // This loops through all the children of the div element
        if(count > 0){ // Checks if we should skip
          count++ // Increments the counter by 1
        }
        if(count > 4){ // Checks if we have skipped 4 elements
          count = 0 // Resets the counter to 0, stopping the skipping
        }
        if(count != 0){ // If we are skipping, we skip this element
          continue // This skips the element
        }
        if(i.tagName == "INPUT" && {{group_subjects | safe}}[{{idx}}].indexOf(i.id) == -1){ // Checks if we should skip this element
          count = 0.1 // Starts the skipping process
          continue // Skips this element
        }
        new_input.appendChild(i.cloneNode(true)) // This clones the element and adds it to the new input element
        if(i.tagName == "INPUT"){ // Checks if the element is an input element
          new_input.lastChild.name = "group6" // This changes the name of the radio button to group6
          new_input.lastChild.checked = false // This unchecks the radio button
          new_input.lastChild.onchange = function(){ // This is the onchange function for the radio button
              for(idx of {{group_subjects[idx] | safe}}){ // This loops through all the subjects in the group
                document.getElementById(idx+"-select-group6").hidden = true // This hides the select element for the subject
              }
              document.getElementById(this.value+"-select-group6").hidden = false // This shows the select element for the selected subject
              if(this.value.includes("Chinese") && document.getElementById("Chinese A").checked){ // Checks if the user has selected Chinese A
                document.getElementById("Chinese A").checked = false // This unchecks the Chinese A radio button
                document.getElementById("Chinese A-select").hidden = true // This hides the select element for Chinese A
                flash("Chinese A has been deselected from your options","info") // This is the info message that is displayed if the user has selected Chinese A
              }
              if(this.value.includes("English") && document.getElementById("English A").checked){ // Checks if the user has selected English A
                document.getElementById("English A").checked = false // This unchecks the English A radio button
                document.getElementById("English A-select").hidden = true // This hides the select element for English A
                flash("English A has been deselected from your options","info") // This is the info message that is displayed if the user has selected English A
              }
              if(this.value.includes("Chinese") && document.getElementById("Chinese B").checked){ // Checks if the user has selected Chinese B
                document.getElementById("Chinese B").checked = false // This unchecks the Chinese B radio button
                document.getElementById("Chinese B-select").hidden = true // This hides the select element for Chinese B
                flash("Chinese B has been deselected from your options","info") // This is the info message that is displayed if the user has selected Chinese B
              }
              if(this.value.includes("English") && document.getElementById("English B").checked){ // Checks if the user has selected English B
                document.getElementById("English B").checked = false // This unchecks the English B radio button
                document.getElementById("English B-select").hidden = true // This hides the select element for English B
                flash("English B has been deselected from your options","info") // This is the info message that is displayed if the user has selected English B
              }
              if(this.value.includes("Chinese") && document.getElementById("Chinese Ab Initio").checked){ // Checks if the user has selected Chinese Ab Initio
                document.getElementById("Chinese Ab Initio").checked = false // This unchecks the Chinese Ab Initio radio button
                document.getElementById("Chinese Ab Initio-select").hidden = true // This hides the select element for Chinese Ab Initio
                flash("Chinese Ab Initio has been deselected from your options","info") // This is the info message that is displayed if the user has selected Chinese Ab Initio
              }
              if(this.value.includes("Spanish") && document.getElementById("Spanish B").checked){ // Checks if the user has selected Spanish B
                document.getElementById("Spanish B").checked = false // This unchecks the Spanish B radio button
                document.getElementById("Spanish B-select").hidden = true // This hides the select element for Spanish B
                flash("Spanish B has been deselected from your options","info") // This is the info message that is displayed if the user has selected Spanish B
              }
              if(this.value.includes("Spanish") && document.getElementById("Spanish Ab Initio").checked){ // Checks if the user has selected Spanish Ab Initio
                document.getElementById("Spanish Ab Initio").checked = false // This unchecks the Spanish Ab Initio radio button
                document.getElementById("Spanish Ab Initio-select").hidden = true // This hides the select element for Spanish Ab Initio
                flash("Spanish Ab Initio has been deselected from your options","info") // This is the info message that is displayed if the user has selected Spanish Ab Initio
              }
              if(this.value.includes("French") && document.getElementById("French B").checked){ // Checks if the user has selected French B
                document.getElementById("French B").checked = false // This unchecks the French B radio button
                document.getElementById("French B-select").hidden = true // This hides the select element for French B
                flash("French B has been deselected from your options","info") // This is the info message that is displayed if the user has selected French B
              }
              if(this.value.includes("French") && document.getElementById("French Ab Initio").checked){ // Checks if the user has selected French Ab Initio
                document.getElementById("French Ab Initio").checked = false // This unchecks the French Ab Initio radio button
                document.getElementById("French Ab Initio-select").hidden = true // This hides the select element for French Ab Initio
                flash("French Ab Initio has been deselected from your options","info") // This is the info message that is displayed if the user has selected French Ab Initio
              }
          }
        }
        if(i.tagName == "SELECT"){ // Checks if the element is a select element
          if(!new_input.lastChild.name.includes("group6")){ // Checks if the select element is not for group 6
            new_input.lastChild.id = new_input.lastChild.id.replace("-select","-select-group6") // This changes the id of the select element to include group6
            new_input.lastChild.name = new_input.lastChild.name.replace("-select","-select-group6") // This changes the name of the select element to include group6
          }
          new_input.lastChild.hidden = true // This hides the select element
        }
      }
      new_input.id = "group6" // This sets the id of the new input element
      new_input.style.display = "block" // This sets the display of the new input element to block
      new_input.className = "form-group" // This sets the class of the new input element to form-group
      submit = document.createElement("input") // This creates a new input element
      submit.type = "submit" // This sets the type of the new input element to submit
      submit.value = "Submit" // This sets the value of the submit button
      submit.className = "btn btn-primary" // This sets the class of the submit button
      submit.style = "background-color:black;border:none" // This sets the style of the submit button
      form.appendChild(art_input) // This adds the art input to the form
      submit.onclick = function(){ // This is the onclick function for the submit button
        event.preventDefault() // This prevents the form from submitting
        hls = 0 // This is the counter for the number of HL subjects
        first_hl = 0 // This is the first HL subject
        doing_courses = false // This is the boolean that represents whether the user is doing IB Courses
        if(document.getElementById(As[As.length-1]).checked && document.getElementById("ssst-input").value == ""){
          flash("Please complete all fields","error") // This is the error message that is displayed if the user has not entered a language for School Supported Self Taught Literature
          if(slide != 0){
            transition(slide,0) // This transitions to the first slide
          }
          slide = 0 // This sets the slide number to 0
          document.getElementById("left").hidden = true // Hides the left arrow
          document.getElementById("right").hidden = false // Shows the right arrow
          return false // This stops the form from submitting
        }
        for(i=1;i<7;i++){ // This loops through all the groups
          if(!document.querySelector("input[name='group"+i.toString()+"']") || !document.querySelector("input[name='group"+i.toString()+"']:checked")){ // Checks if the user has not selected a subject for the group
            flash("Please complete all fields","error") // This is the error message that is displayed if the user has not completed all fields
            if(i!=6){ // Checks if the user is not on the last slide
              if(slide != i){
                transition(slide,i+1) // This transitions to the slide that the user has not completed
              }
              slide = i+1// This sets the slide number to the slide that the user has not completed
            }
            if(i == 1){ // Checks if the user is on the first slide
              document.getElementById("left").hidden = true // Hides the left arrow
            }
            else{ // The user is not on the first slide
              document.getElementById("left").hidden = false // Shows the left arrow
            }
            if(i == 6){ // Checks if the user is on the last slide
              document.getElementById("right").hidden = true // Hides the right arrow
            }
            else{ // The user is not on the last slide
              document.getElementById("right").hidden = false // Shows the right arrow
            }
            return false // This stops the form from submitting
          }
          if(i != 6 && document.querySelector("input[name='group"+i.toString()+"']:checked").value == "IB Courses"){ // Checks if the user has selected IB Courses for the group
            doing_courses = true // This sets the boolean that represents whether the user is doing IB Courses to true
          }
          if(doing_courses){ // Checks if the user is doing IB Courses
            continue // Skips the HL requirement as the user is not doing the full diploma
          }
          if((i==6 && document.getElementById(document.querySelector("input[name='group6']:checked").value+"-select-group6").value == "HL") || document.getElementById(document.querySelector("input[name='group"+i.toString()+"']:checked").value+"-select").value == "HL"){ // Checks if the user has selected an HL subject
            hls++ // Increments the HL counter by 1
            if(first_hl == 0){ // Checks if this is the first HL subject
              first_hl = i // This sets the first HL subject to the current group
            }
          }
        }
        if(hls != 3 && !doing_courses){ // Checks if the user has selected exactly 3 HL subjects
          flash("Please select exactly 3 HL subjects","error") // This is the error message that is displayed if the user has not selected exactly 3 HL subjects
          if(slide != 2){ // Checks if the user is not on the first slide
            transition(slide,2) // This transitions to the first slide
          }
          slide = 2 // This sets the slide number to 2
          document.getElementById("left").hidden = false // Shows the left arrow
          document.getElementById("right").hidden = false // Shows the right arrow
          return false // This stops the form from submitting
        }
        if(document.querySelector("input[name='group6']:checked").value ==  document.querySelector("input[name='group3']:checked").value){ // Checks if the user has selected the same subject in group 3 and group 6
          flash("You cannot select the same subject in group 3 and group 6","error") // This is the error message that is displayed if the user has selected the same subject in group 3 and group 6
          if(slide != 4){ // Checks if we should animate the transition to slide 3
            transition(slide,4) // Transitions to slide 3
          }
          slide = 4 // This sets the slide number to 4
          document.getElementById("left").hidden = false // Shows the left arrow
          document.getElementById("right").hidden = false // Shows the right arrow
          return false // Breaks the function, preventing the form from submitting
        }
        if(document.querySelector("input[name='group6']:checked").value == document.querySelector("input[name='group4']:checked").value){ // Checks if the user has selected the same subject in group 4 and group 6
          flash("You cannot select the same subject in group 4 and group 6","error") // This is the error message that is displayed if the user has selected the same subject in group 4 and group 6
          if(slide != 5){ // Checks if we should animate the transition to slide 5
            transition(slide,5) // Transitions to slide 5
          }
          slide = 5 // This sets the slide number to 4
          document.getElementById("left").hidden = false // Shows the left arrow
          document.getElementById("right").hidden = false // Shows the right arrow
          return false // Breaks the function, preventing the form from submitting
        }
        unsaved = false // This prevents the user from being prompted to save changes
        form.submit() // This submits the form
      }
      new_input.appendChild(submit) // This adds the submit button to the form
      try{ // This is the try block that is used to check if the group 6 input already exists
        document.getElementById("group6").replaceWith(new_input) // This replaces the group 6 input with the new group 6 input
      }
      catch{ // This is the exception that is thrown if the group 6 input does not exist
        form.appendChild(new_input) // This adds the new group 6 input to the form
      }
      document.getElementById("group6").style.display = "none" // This hides the group 6 input
      slides[slides.length-1] = new_input // This updates the slides list to include the new group 6 input
    }
    label = document.createElement("label") // This creates a new label element
    label.for = "{{group}}" // This sets the for attribute of the label
    label.innerText = "{{group}}" // This sets the inner text of the label
    group6_input.appendChild(radio) // This adds the radio button to the form
    group6_input.appendChild(label) // This adds the label to the form
    newline = document.createElement("br") // This creates a new line element
    group6_input.appendChild(newline) // This adds a newline to the form
    {%set counter.value = counter.value+1%} // Increments the counter by 1
  {%endfor%} // Closes the for loop
  form.appendChild(group6_input) // This adds the group 6 input to the form
  h3 = document.createElement("h3") // This creates a new h3 element
  h3.innerText = "Select your subject from the arts:" // This sets the inner text of the h3 element
  h5 = document.createElement("h5") // This creates a new h5 element
  h5.innerHTML = "For Music you need to be able to play a musical instrument at approximately a Grade 5 level. "
  art_input = document.createElement("div") // This creates a new div element
  art_input.appendChild(h3) // This adds the h3 element to the div element
  art_input.appendChild(h5) // This adds the h5 element to the div element
  art_input.className = "form-group" // This sets the class of the div element
  for(var art of arts){ // This loops through all the art subjects
    radio = document.createElement("input") // This creates a new input element
    radio.type = "radio" // This sets the type of the input element
    radio.name = "group6" // This sets the name of the radio button
    radio.value = art // This sets the value of the radio button
    radio.id = art // This sets the id of the radio button
    radio.required = true // This makes the radio button required
    label = document.createElement("label") // This creates a new label element
    label.for = art // This sets the for attribute of the label
    label.innerText = art // This sets the inner text of the label
    select = document.createElement("select") // This creates a new select element
    select.id = art+"-select" // This sets the id of the select element
    select.className = "form-control" // This sets the class of the select element
    select.name = art+"-select" // This sets the name of the select element
    select.hidden = true // This hides the select element for the art subject
    option = document.createElement("option") // This creates a new option element
    option.value = "SL" // This sets the value of the option element
    option.innerText = "SL" // This sets the inner text of the option element
    select.appendChild(option) // This adds the option to the select element
    option = document.createElement("option") // This creates a new option element
    option.value = "HL" // This sets the value of the option element
    option.innerText = "HL" // This sets the inner text of the option element
    select.appendChild(option) // This adds the option to the select element
    radio.onchange = function(){ // This is the onchange function for the radio button
      for(i of arts){ // This loops through all the art subjects
        document.getElementById(i+"-select-group6").hidden = true // This hides the select element for the art subject
      }
      document.getElementById(this.value+"-select-group6").hidden = false // This shows the select element for the selected art subject
    }
    art_input.appendChild(radio) // This adds the radio button to the form
    art_input.appendChild(label) // This adds the label to the form
    art_input.appendChild(select) // This adds the select element to the form
    newline = document.createElement("br") // This creates a new line element
    art_input.appendChild(newline) // This adds a newline to the form
  }
</script>
{%endblock%}